{% extends 'base.html' %}

{% block content %}
<header>
    <div class="row">
        <div class="col">
            <h1>SFPD Dispatch - Metrics</h1>
        </div>
    </div>
</header>

<div class="container">
    <!-- Metric charts HTML/JavaScript -->
    {% include 'charts.html' %}

    <div class="row">
        <div class="col-sm">
            <form id="dispatchTypeForm" method="post">
                <div class="form-group">
                    <label for="address">Street Address</label>
                    <input name="address" type="text" class="form-control" id="address" aria-describedby="addressHelp" placeholder="Enter a street address">
                    <small id="addressHelp" class="form-text text-muted">Enter the location for the dispatch.</small>
                </div>
                <div class="form-group">
                    <label for="timestamp">Time</label>
                    <div class="input-append">
                        <input name="time" class="form-control" aria-describedby="timestampHelp" type="time" step="1"></input>
                    </div>
                    <small id="timestampHelp" class="form-text text-muted">Enter the timestamp for the dispatch.</small>
                </div>
                <button type="submit" class="btn btn-primary">Calculate Dispatch Type</button>
                {% csrf_token %}
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% load static %}
{% block scripts %}
{{ block.super }}
<script type="text/javascript" src="{% static 'js/Chart.bundle.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/metrics_charts.js' %}"></script>
<script>
$("#dispatchTypeForm").submit(function(e) {
    var endpoint = '/api/calls/nearby';
    $.ajax({
        method: "POST",
        url: endpoint,
        data: $("#dispatchTypeForm").serialize(),
        success: function(data) {
            console.log(data);
            // Get nearby calls
            getNearbyCalls(data);
        },
        error: function(resp) {
            console.log(resp);
        }
    });

    // Prevent form submit causing page change
    e.preventDefault();
});

function getNearbyCalls(data) {
    data = {

    }
    var ctx = $("#unitTypeDistrib");
}
</script>
{% endblock %}